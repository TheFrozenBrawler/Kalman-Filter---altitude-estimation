# Kalman Filter Based on Model mk. 2
This Kalman filter is part of a engineering thesis at the end of my bachelor degree of Automatic Control and Robotics on Poznan University of Technology.

## Project setup
Created with Python 3.11.9
### Windows
1. Clone repository:
    ```cmd
    git clone https://github.com/TheFrozenBrawler/Kalman-Filter---altitude-estimation
    cd Kalman-Filter---altitude-estimation
    ```

2. Run the environment configuration script:
    ```cmd
    .\setup.bat
    ```

3. To run the program, do the following:
    ```cmd
    .\run.bat
    ```

## Project description
### Project elements
* **main.py** - main script of the project
* **KalmanFilter_class.py** - Kalman Filter class with linear KF equations
* **noise_adder.py** - file for adding noise to measurements
* **data folder** - folder with simulated data of rocket flight
* **config.py** - file with configuration of the project
* **pressure_preprocessing.py** - file with algorithm to calculate altitude from pressure

### test files
* **test_model.py** - file with only model equations of rocket
* **press_preproc_test.py** - file to test the pressure preprocessor

### Kalman Filter description
The filter uses state model and with given measurements of altitude and acceleration estimates the altitude and velocity of the rocket. Kalman filter itself is linear, but works in this case with average value of RMSE per test equal to 30m.

### Rocket altitude measurements
Current version of the filter uses simulated measurements of pressure to pre-calculate the altitude and than pass it to the filter. 

### Engineering Thesis descripion
The main goal of the thesis is to create an algorithm to detect a rocket apogee with barometric measurements. To achieve this goal, an altitude must be estimated with use of fine-tuned Kalman Filter. This thesis is part of a project of PUT Rocketlab Student Group. The algorithm will be used during the Spaceport America Cup - an amateur rocketry competition.

### Kalman Filter description
The Kalman filter is based on the model mk. 2 from my private notes.
The model is based on the differential equation of an object, where the state vector consists of position and velocity. The input to the model is simulated acceleration with noise. The measurements are values of simulated altitude with noise.
The filter and model was developed with help of the guidebook "Kalman Filter From The Ground-Up".

### Measurements
All measurement files were generated by the model in Open Rocket software.

### State model
The state model has been derived from the state space representation of dynamic object moving in one dimension - estimation of rocket heigth.

![state space representation](img/state_eq_model.png)

With given matrices A, B, C, D the differential equation can be solved and written as:

![derivative model](img/deriv_model.png)

## TO DO:
- Improve the Q, P and R matrices 
- Think about EKF or UKF
- add apogee detection system based on counting the number of estimated velocity samples equal or less than zero in apogee
- add P matrix reset to get rid of artifact in the filter
- implement the filter in C
- test with 2023 flight data
- handling N/A data, especially in the apogee region
